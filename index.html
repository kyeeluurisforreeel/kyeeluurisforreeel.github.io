<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diamond Launcher</title>
  <style>
    html,body{height:100%;margin:0}
    body{display:flex;align-items:center;justify-content:center;background:#071225;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;color:#e6f7ff}
    .msg{max-width:720px;background:#071022;border:1px solid rgba(255,255,255,0.04);padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(2,8,23,0.6);text-align:center}
    .btn{background:linear-gradient(90deg,#1e90ff,#4aa3ff);border:0;color:#001022;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    a{color:#9fd1ff}
  </style>
</head>
<body>
  <div id="fallback"></div>

  <script>
    var openSetting = localStorage.getItem('diamond_open_about_blank');
    if (openSetting === 'false') {
      document.getElementById('fallback').innerHTML =
        '<div class="msg">Auto-open is disabled in settings. <button id="openManual" class="btn">Open Diamond</button></div>';
      document.getElementById('openManual').addEventListener('click', function(){
        openDiamond();
      });
    } else {
      openDiamond();
    }

    function openDiamond(){
      var win = window.open('about:blank', '_blank');
      if (!win) {
        document.getElementById('fallback').innerHTML =
          '<div class="msg">Popup blocked. Allow popups for this site or click below.<br><br><button id="openManual" class="btn">Open Diamond</button></div>';
        document.getElementById('openManual').addEventListener('click', function(){
          var w = window.open('about:blank', '_blank');
          if (!w) return;
          writeDiamond(w);
        });
      } else {
        writeDiamond(win);
      }
    }

    function writeDiamond(win){
      var base = location.origin;
      win.document.write('<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Diamond</title><link rel="stylesheet" href="'+base+'/styles.css"><link rel="icon" href="data:,"></head><body><div class=\"app\" role=\"application\" aria-label=\"Diamond UI\"><div class=\"header\"><div class=\"logo\">♦</div><div><div class=\"title\">Diamond</div><div class=\"subtitle\">Blue, clean, responsive</div></div></div><div class=\"main\"><div class=\"panel page\" id=\"page\"><div id=\"home\" class=\"home-content\"><h1>Welcome to Diamond</h1><p>Diamond is running inside about:blank. Use the navigation below to explore. The search feature will be added later.</p></div><div id=\"search\" class=\"search-placeholder hidden\">Search coming soon</div></div></div><div class=\"bottom-bar\"><div class=\"nav\" role=\"navigation\" aria-label=\"Bottom navigation\"><div class=\"left\"><div class=\"app-name\">Diamond</div><div class=\"small\">v1</div></div><div class=\"center controls\"><button class=\"btn\" id=\"homeBtn\" title=\"Home\"><svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M3 11.5L12 4l9 7.5\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>Home</button><button class=\"btn\" id=\"searchBtn\" title=\"Search\"><svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M21 21l-4.35-4.35\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"11\" cy=\"11\" r=\"5\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>Search</button><button class=\"btn\" id=\"settingsBtn\" title=\"Settings\"><svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z\" stroke=\"currentColor\" stroke-width=\"1.4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>Settings</button></div><div style=\"width:10px\"></div><div class=\"right small\">Running in about:blank</div></div></div></div><div id=\"settings\" class=\"settings-panel\" style=\"display:none\"><div style=\"position:relative\"><div class=\"close-x\" id=\"closeSettings\">×</div><h3 style=\"margin:0 0 8px 0\">Settings</h3><div class=\"field\"><label class=\"small\">Open in about:blank</label><div class=\"toggle\" id=\"toggleOpen\"><div id=\"switch\" class=\"switch\"><div id=\"knob\" class=\"knob\"></div></div><div id=\"switchLabel\" class=\"small\" style=\"min-width:120px\">Enabled</div></div></div><div class=\"field\"><label class=\"small\">Search engine</label><select id=\"engine\" class=\"select\" aria-label=\"Search engine\"><option value=\"duckduckgo\">DuckDuckGo</option><option value=\"google\">Google</option><option value=\"bing\">Bing</option></select></div><div class=\"field\"><label class=\"small\">Search proxy</label><select id=\"proxy\" class=\"select\" aria-label=\"Search proxy\"><option value=\"scramjet\">Scram Jet</option></select></div><div style=\"display:flex;justify-content:flex-end;gap:8px;margin-top:8px\"><button id=\"saveSettings\" class=\"btn primary\">Save</button></div></div></div><script src="'+base+'/diamond.js"></script></body></html>');
      win.document.close();
    }
  </script>
</body>
</html>
